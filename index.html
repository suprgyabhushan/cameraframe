<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Smart Device Camera Template for HTML, CSS, JS and WebRTC">
  <meta name="keywords" content="HTML,CSS,JavaScript, WebRTC, Camera">
  <meta name="author" content="Kasper Kamperman">
  <title>Camera Frame</title>
  <script type="text/javascript" src="js/clmtrackr.js"></script>
  <!-- Load TensorFlow.js -->
  <script src="https://unpkg.com/@tensorflow/tfjs"></script>
  <!-- Load Posenet -->
  <script src="https://unpkg.com/@tensorflow-models/posenet">
  </script>

  <link rel="stylesheet" type="text/css" href="style1.css">
</head>
<body>
  <div id="container">
    <div id="vid_container">
        
        <video id="video" width="320" height="240" autoplay playsinline></video>
        <canvas id="camerasensor" width="320" height="240"></canvas>
        <canvas id="cameramotion" width="160" height="200"></canvas>
        <canvas id="eyes" width="50" height="25"></canvas>
        <style>
        #eyes
        {
            position: absolute;
            top: 0;
            right: 0;
        }
        </style>
        
        <div id="video_overlay"></div>
    </div>
    <div id="gui_controls">
        
        <button id="switchCameraButton" name="switch Camera" type="button" aria-pressed="false"></button>
        <button id="takePhotoButton" name="take Photo" type="button" onclick="take1()">	</button>
        <button id="startFaceTrackingButton" name=" start FaceTracking" type="button" onclick="start()"></button>
        <button id="toggleFullScreenButton" name="toggle FullScreen" type="button" aria-pressed="false"></button>
       
        <img src="//:0" alt="" id="cameraoutput">
    </div>
  </div> 
  <script src="js/DetectRTC.min.js"></script>
  <script src="js/adapter.min.js"></script>  
  <script src="js/screenfull.min.js"></script>
  <script src="js/howler.core.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/creative_coding.js"></script>
  <script type="text/javascript">

    var video = document.getElementById('video');
    var w = video.width;
    var h = video.height;
    var overlay = document.getElementById('camerasensor');
    
    var ctx = overlay.getContext('2d');
    
    var cameraOutput = document.getElementById('cameraoutput');
      
    var ctrack = new clm.tracker();
    ctrack.init();
    var trackingStarted = false;

    function start() {
        video.play();
        ctrack.start(video);
        trackingStarted = true;
        
       
        drawLoop();
        
    }
    function drawLoop() {  
        requestAnimationFrame(drawLoop);
        ctx.clearRect(0, 0, w, h);
        if (ctrack.getCurrentPosition())
        {
            
            ctrack.draw(overlay);
            const eyesRect = getEyesRectangle(ctrack.getCurrentPosition());
            ctx.strokeStyle = 'red';
            ctx.strokeRect(eyesRect[0], eyesRect[1], eyesRect[2], eyesRect[3]);
            // The video might internally have a different size, so we need these
            // factors to rescale the eyes rectangle before cropping:
            const resizeFactorX = video.videoWidth / video.width;
            const resizeFactorY = video.videoHeight / video.height;

            // Crop the eyes from the video and paste them in the eyes canvas:
            const eyesCanvas = $('#eyes')[0];
            const eyesCC = eyesCanvas.getContext('2d');

            eyesCC.drawImage(
                video,
                eyesRect[0] * resizeFactorX, eyesRect[1] * resizeFactorY,
                eyesRect[2] * resizeFactorX, eyesRect[3] * resizeFactorY,
                0, 0, eyesCanvas.width, eyesCanvas.height
            );
            
        }
        
    }

    function getEyesRectangle(positions) {
        const minX = positions[23][0] - 5;
        const maxX = positions[28][0] + 5;
        const minY = positions[24][1] - 5;
        const maxY = positions[26][1] + 5;

        const width = maxX - minX;
        const height = maxY - minY;

        return [minX, minY, width, height];
    }
   
    function draw1()
    {

        ctx.drawImage(video, 150, 0, 900, 1500, 0, 0, 850, 850);    
    }

    function take1()
    {
        const eyesRect1 = getEyesRectangle(ctrack.getCurrentPosition());
        if(eyesRect1[0] > 130)
        {
            take();
        }
        
    }

    
    function take()
    {
        var video = document.getElementById('video');
        var cameraOutput = document.getElementById('cameraoutput');
        var canvas = document.createElement('canvas');

        var width = video.videoWidth;
        var height = video.videoHeight;

        canvas.width = width;
        canvas.height = height;

        context = canvas.getContext('2d');
        context.drawImage(video, 0, 0);
        cameraOutput.src = canvas.toDataURL("image/webp");
        cameraOutput.classList.add("taken");
    }

  </script>
 
 


  

  
  
</body>
</html>
